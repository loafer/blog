Zookeeper —— Java 客户端

Zookeeper的Java绑定有两个包：**org.apache.zookeeper **和** org.apache.zookeeper.data**。其他包为内部使用或是服务实现的一部分。** org.apache.zookeeper.data**由生成的类组成，被用作简单的容器。

**Zookeeper**是客户端使用的主要类。Zookeeper支持一个进程中的跨实例Session恢复。开发人员可以将session id和password保存起来，重启后，能恢复以前实例使用的会话。

在创建Zookeeper对象的同时，会创建两个进程：IO线程和事件进程。所有IO操作发生在IO线程上，多有的事件回调发生在事件进程上。在IO线程上维护与Zookeeper服务的会话和心跳检测。同步方法应答也是在IO线程上。所有的异步方法应答和监视事件在事件进程中处理。对于这种设计，应注意以下事情：

- 所有完成的异步调用和监视事件回调是有顺序的，一次一个。在这个时期，调用者可以做它想做的事，但是其他回调不会被处理（因为回调是有顺序的，只能处理完一个再处理下一个）。

- 回调不会阻塞IO线程或者同步调用处理。

- 同步调用不会按正确的顺序返回。假设，一个客户端执行下面的处理：对节点/a发起一个异步读，同时设置监视器，然后读回调完成后，执行一个同步读/a。

注意：如果，在异步读和同步读之间/a发生了变化，客户端在得到同步读响应前，会收到一个监视事件，说/a变化了。但由于异步读回调阻塞了事件队列，同步读会返回/a的新值，然后监视器才会被处理。

最后，与shutdown相关联的规则很直白：一旦一个ZooKeeper对象关闭或者收到一个严重事件(SESSION_EXPIRED和AUTH_FAILED), ZooKeeper对象就变成无效了。关闭后，这两个线程也停止了，任何在ZooKeeper句柄上的操作就变得不可预测，应避免这种情况出现